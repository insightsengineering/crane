% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gkm.R
\name{h_data_plot}
\alias{h_data_plot}
\alias{g_km}
\alias{annot_surv_med}
\alias{annot_cox_ph}
\alias{annot_at_risk}
\title{Generate a Kaplan-Meier Plot}
\usage{
h_data_plot(fit_km, armval = "All", max_time = NULL)

g_km(
  surv_plot_data,
  col = NULL,
  lty = NULL,
  lwd = 0.5,
  censor_show = TRUE,
  pch = 3,
  size = 2,
  max_time = NULL,
  xticks = NULL,
  xlab = "Days",
  yval = c("Survival", "Failure"),
  ylab = paste(yval, "Probability"),
  ylim = NULL,
  title = NULL,
  footnotes = NULL,
  font_size = 10,
  ci_ribbon = FALSE,
  legend_pos = NULL,
  ggtheme = NULL
)

annot_surv_med(
  gg_plt,
  fit_km,
  control_annot_surv_med = control_surv_med_annot(),
  font_size = 10
)

annot_cox_ph(
  gg_plt,
  coxph_tbl,
  control_annot_coxph = control_coxph_annot(),
  font_size = 10
)

annot_at_risk(
  gg_plt,
  fit_km,
  font_size = 10,
  annot_at_risk_title = TRUE,
  rel_height_plot = 0.75,
  xlab = "Days"
)
}
\arguments{
\item{fit_km}{A fitted Kaplan-Meier object of class \code{survfit}, used to generate the table data.}

\item{armval}{Character string for the strata level if \code{fit_km} has no strata (e.g., "All").}

\item{max_time}{Numeric, the maximum time point to display on the x-axis.}

\item{surv_plot_data}{A data frame containing the pre-processed survival data, ready for plotting.
This data should be equivalent to the output of \code{h_data_plot}.}

\item{col}{A character vector of colors for the survival curves. Length should match number of arms.}

\item{lty}{A vector of line types for the survival curves, or \code{NULL} for default.}

\item{lwd}{Numeric value specifying line width for the survival curves.}

\item{censor_show}{Logical, whether to display censoring marks on the plot.}

\item{pch}{Plotting character for censoring marks.}

\item{size}{Size of the censoring marks.}

\item{xticks}{Numeric vector of x-axis tick positions, or a single number for the interval, or \code{NULL} for auto.}

\item{xlab}{Character string for the x-axis label on the 'at-risk' table (typically time).}

\item{yval}{Character string, either \code{"Survival"} or \code{"Failure"} to plot Survival or Failure probability.}

\item{ylab}{Character string for the y-axis label.}

\item{ylim}{Numeric vector of length 2 for y-axis limits.}

\item{title}{Character string for the plot title.}

\item{footnotes}{Character string for plot footnotes/caption.}

\item{font_size}{Numeric, base font size for the table.}

\item{ci_ribbon}{Logical, whether to display confidence intervals as a ribbon (area).}

\item{legend_pos}{Numeric vector of length 2 for legend position (x, y) relative to the plot area (0 to 1), or \code{NULL} for auto-placement.}

\item{ggtheme}{An optional \code{ggplot2} theme to apply.}

\item{gg_plt}{A \code{ggplot2} or \code{cowplot} object of the Kaplan-Meier plot.}

\item{control_annot_surv_med}{A list of control parameters for the annotation box.}

\item{coxph_tbl}{A data frame containing pre-calculated Cox-PH results.}

\item{control_annot_coxph}{A list of control parameters for the annotation box.}

\item{annot_at_risk_title}{Logical, whether to include the title "Patients at Risk:".}

\item{rel_height_plot}{Numeric, relative height of the main plot area compared to the 'at-risk' table (0 to 1).}
}
\value{
The function \code{h_data_plot} returns a data frame containing the survival curve steps, confidence intervals, and censoring info.

The function \code{g_km} returns a \code{ggplot2} object of the KM plot.

The \code{annot_surv_med} function returns a \code{cowplot} object with the median survival table annotation added.

The function \code{annot_surv_med} returns a \code{cowplot} object with the Cox-PH table annotation added.

The function \code{annot_at_risk} returns a \code{cowplot} object combining the KM plot and the 'Numbers at Risk' table.
}
\description{
The function \code{h_data_plot} takes a fitted \code{survfit} object and processes it into a data frame
suitable for plotting a Kaplan-Meier curve with \code{ggplot2}, including extending
the curve to time zero.

The function \code{g_km} creates a comprehensive \code{ggplot2} object for a Kaplan-Meier
survival curve, with support for various customizations like censoring marks, CIs, and axis control.

The \code{annot_surv_med} function adds a median survival time summary table as an annotation box on a
Kaplan-Meier plot using \code{cowplot}.

The function \code{annot_cox_ph} adds a Cox Proportional Hazards summary table created by the function \code{\link{get_cox_pairwise_tbl}} as an annotation box on a
Kaplan-Meier plot using \code{cowplot}.

The function \code{annot_at_risk} adds a "Numbers at Risk" table below a Kaplan-Meier plot using \code{cowplot::plot_grid}.
}
\examples{
# Example data setup (assuming 'time' is event time, 'status' is event indicator (1=event),
# and 'arm' is the treatment group)
library(survival)
use_lung <- lung
use_lung$arm <- factor(sample(c("A", "B", "C"), nrow(use_lung), replace = TRUE))
use_lung$status <- use_lung$status - 1 # Convert status to 0/1
use_lung <- na.omit(use_lung)
formula <- Surv(time, status) ~ arm
fit_kmg01 <- survfit(formula, use_lung)
surv_plot_data <- h_data_plot(fit_kmg01)
head(surv_plot_data)

# Example of making the KM plot
plt_kmg01 <- g_km(surv_plot_data,
  xlab = "Time (Days)"
)

# Annotate Kaplan-Meier Plot with Median Survival Table
annot_surv_med(plt_kmg01, fit_kmg01)

# Annotate Kaplan-Meier Plot with Cox-PH Table
coxph_tbl <- get_cox_pairwise_tbl(formula, data = use_lung, arm = "arm", ref_group = "A")
annot_surv_med(plt_kmg01, coxph_tbl)

Annotate Plot with Numbers at Risk Table
annot_at_risk(plt_kmg01, fit_kmg01)

}
